#define  nMADS 18 // number of MA grid divisions
#define  nX 45    // Number of X grid divisions

double DsDxBilinearInterpPseudoScalars(double MAtest, double Xtest) {

  double NormDsDx[nMADS][nX];

  // mass of A' in GeV
  double MMAA[nMADS] = {0.000001, 0.00001, 0.00002, 0.00003, 0.00004, 0.00005, 0.00006, 0.00007, 0.0001, 0.00015, 0.0002, 0.0003, 0.0004, 0.0005, 0.0006, 0.0007, 0.0008, 0.0009};

  // Fraction carried out by A'
  double XX00[nX] = {0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.1,0.15,0.2,0.25,0.3,0.35,0.4,0.45,0.5,0.55,0.6,0.65,0.7,0.75,0.8,0.85,0.9,0.91,0.92,0.93,0.94,0.95,0.96,0.97,0.98,0.99,0.9999,0.99991,0.99992,0.99993,0.99994,0.99995,0.99996,0.99997,0.99998,0.99999};

  double NormOnMaxDPDsDxETL1keVEe20GeV[nX]={0.00979591, 0.0202506, 0.0305649, 0.0408417, 0.0511034, 0.0613574, 0.0716066, 0.081853, 0.0920978, 0.102341, 0.153547, 0.204745, 0.255937, 0.307126, 0.358313, 0.409496, 0.460676, 0.511851, 0.563019, 0.614181, 0.665331, 0.716465, 0.767571, 0.818631, 0.869594, 0.920326, 0.930394, 0.940462, 0.95041, 0.960359, 0.970017, 0.979676, 0.988176, 0.996677, 1., 0.351453, 0.320538, 0.289624, 0.25871, 0.227795, 0.196881, 0.165967, 0.0829834, 0., 0.};
  double NormOnMaxDPDsDxETL10keVEe20GeV[nX]={0.00191556, 0.00968851, 0.0205863, 0.0321452, 0.0436228, 0.0548876, 0.065955, 0.0768642, 0.0876515, 0.0983448, 0.15096, 0.202913, 0.254556, 0.306053, 0.357457, 0.408806, 0.460113, 0.511392, 0.562643, 0.613875, 0.665085, 0.71627, 0.76742, 0.818519, 0.869516, 0.920279, 0.930352, 0.940426, 0.95038, 0.960334, 0.969997, 0.979661, 0.988166, 0.996671, 1., 0.351454, 0.32054, 0.289625, 0.258711, 0.227796, 0.196882, 0.165968, 0.0829838, 0., 0.};
  double NormOnMaxDPDsDxETL20keVEe20GeV[nX]={0.000598847, 0.00386151, 0.0104393, 0.0195856, 0.0302346, 0.0415967, 0.0532184, 0.0648723, 0.0764563, 0.0879307, 0.143632, 0.197555, 0.25046, 0.302845, 0.354887, 0.406727, 0.458416, 0.510004, 0.561508, 0.612952, 0.664341, 0.71568, 0.766964, 0.818181, 0.869281, 0.920136, 0.930227, 0.940318, 0.950288, 0.960259, 0.969938, 0.979617, 0.988137, 0.996657, 1., 0.351459, 0.320544, 0.289629, 0.258714, 0.2278, 0.196885, 0.16597, 0.082985, 0., 0.};
  double NormOnMaxDPDsDxETL30keVEe20GeV[nX]={0.000289923, 0.00198936, 0.00583872, 0.011976, 0.0200951, 0.0296986, 0.0402976, 0.0515038, 0.0630444, 0.0747402, 0.132899, 0.189225, 0.243919, 0.297643, 0.350685, 0.40331, 0.455615, 0.507708, 0.559626, 0.61142, 0.663104, 0.7147, 0.766205, 0.817618, 0.86889, 0.919904, 0.93002, 0.940137, 0.950134, 0.960132, 0.969837, 0.979542, 0.988087, 0.996633, 1., 0.351467, 0.320551, 0.289636, 0.25872, 0.227805, 0.196889, 0.165974, 0.0829869, 0., 0.};
  double NormOnMaxDPDsDxETL40keVEe20GeV[nX]={0.000171448, 0.00120848, 0.00367036, 0.00784799, 0.0137792, 0.0213054, 0.0301574, 0.0400351, 0.0506592, 0.0617978, 0.120342, 0.178672, 0.235316, 0.290652, 0.344968, 0.39862, 0.451751, 0.504527, 0.557012, 0.609287, 0.661381, 0.713332, 0.765145, 0.81683, 0.868342, 0.919571, 0.929727, 0.939883, 0.949919, 0.959955, 0.969696, 0.979438, 0.988018, 0.996599, 1., 0.351479, 0.320562, 0.289645, 0.258729, 0.227812, 0.196896, 0.165979, 0.0829896, 0., 0.};
  double NormOnMaxDPDsDxETL50keVEe20GeV[nX]={0.000113539, 0.000812931, 0.00251338, 0.00549252, 0.00989024, 0.0157164, 0.0228765, 0.0312076, 0.0405156, 0.0506029, 0.107351, 0.166717, 0.225112, 0.282131, 0.337885, 0.392747, 0.446878, 0.500496, 0.553686, 0.606567, 0.659178, 0.71158, 0.763786, 0.815819, 0.867639, 0.919144, 0.929351, 0.939558, 0.949643, 0.959727, 0.969516, 0.979304, 0.987929, 0.996555, 1., 0.351491, 0.320574, 0.289656, 0.258739, 0.227821, 0.196904, 0.165986, 0.082993, 0., 0.};
  double NormOnMaxDPDsDxETL60keVEe20GeV[nX]={0.0000808629, 0.000585251, 0.00182929, 0.00404943, 0.00740295, 0.0119663, 0.0177402, 0.0246629, 0.0326273, 0.0415009, 0.094891, 0.154118, 0.213787, 0.272369, 0.329615, 0.3858, 0.441063, 0.495656, 0.549676, 0.603276, 0.656506, 0.709452, 0.762133, 0.814588, 0.866781, 0.918623, 0.928892, 0.939161, 0.949305, 0.95945, 0.969296, 0.979141, 0.987822, 0.996502, 1., 0.351511, 0.320592, 0.289672, 0.258753, 0.227833, 0.196914, 0.165995, 0.0829973, 0., 0.};
  double NormOnMaxDPDsDxETL70keVEe20GeV[nX]={0.0000605858, 0.000442111, 0.00139225, 0.00310805, 0.00573785, 0.00937897, 0.0140772, 0.01983, 0.0265944, 0.0342959, 0.0835045, 0.141495, 0.2018, 0.261668, 0.320349, 0.377899, 0.434383, 0.490055, 0.545011, 0.599431, 0.653376, 0.706953, 0.760188, 0.813138, 0.86577, 0.918008, 0.92835, 0.938693, 0.948907, 0.959121, 0.969035, 0.978949, 0.987695, 0.99644, 1., 0.351532, 0.320611, 0.28969, 0.258769, 0.227847, 0.196926, 0.166005, 0.0830024, 0., 0.};
  double NormOnMaxDPDsDxETL100keVEe20GeV[nX]={0.0000308841, 0.000229279, 0.000731859, 0.00165664, 0.00310597, 0.00516622, 0.00790669, 0.0113786, 0.0156144, 0.0206283, 0.0570559, 0.107217, 0.165507, 0.226738, 0.288546, 0.349793, 0.410025, 0.469251, 0.527452, 0.584814, 0.641383, 0.697319, 0.752656, 0.8075, 0.861829, 0.915603, 0.926231, 0.93686, 0.947349, 0.957839, 0.968017, 0.978195, 0.987194, 0.996194, 1., 0.351615, 0.320687, 0.289758, 0.25883, 0.227902, 0.196973, 0.166045, 0.0830223, 0., 0.};
  double NormOnMaxDPDsDxETL150keVEe20GeV[nX]={0.000014222, 0.00010751, 0.000347366, 0.000794746, 0.00150604, 0.00253354, 0.00392543, 0.00572548, 0.00797271, 0.0107009, 0.0326209, 0.0677461, 0.115278, 0.171041, 0.232224, 0.295907, 0.360529, 0.425039, 0.488871, 0.551839, 0.613784, 0.674789, 0.734822, 0.794013, 0.852324, 0.909765, 0.921084, 0.932402, 0.943556, 0.954709, 0.96553, 0.976351, 0.985971, 0.995592, 1., 0.351819, 0.320873, 0.289927, 0.25898, 0.228034, 0.197088, 0.166142, 0.083071, 0., 0.};
  double NormOnMaxDPDsDxETL200keVEe20GeV[nX]={0.00000815681, 0.0000624268, 0.000203282, 0.000467952, 0.000891661, 0.00150805, 0.00234932, 0.00344623, 0.00482801, 0.0065222, 0.0207222, 0.0451762, 0.0814209, 0.127679, 0.182715, 0.243599, 0.308554, 0.375578, 0.443525, 0.511499, 0.578947, 0.64561, 0.711254, 0.775886, 0.839376, 0.901721, 0.913975, 0.92623, 0.938297, 0.950365, 0.962073, 0.973781, 0.984264, 0.994747, 0.999996, 0.352102, 0.321131, 0.290161, 0.25919, 0.228219, 0.197248, 0.166277, 0.0831386, 0., 0.};
  double NormOnMaxDPDsDxETL300keVEe20GeV[nX]={0.00000369927, 0.0000287858, 0.0000947344, 0.000219807, 0.00042159, 0.000717246, 0.00112363, 0.00165736, 0.00233483, 0.00317224, 0.0104335, 0.0237002, 0.0450861, 0.0749859, 0.114519, 0.162677, 0.219253, 0.282367, 0.351028, 0.423399, 0.49841, 0.574782, 0.651705, 0.728481, 0.804559, 0.879552, 0.894315, 0.909077, 0.923632, 0.938186, 0.952353, 0.96652, 0.979426, 0.992333, 0.999969, 0.352907, 0.321866, 0.290825, 0.259784, 0.228744, 0.197703, 0.166662, 0.0833309, 0., 0.};
  double NormOnMaxDPDsDxETL400keVEe20GeV[nX]={0.00000210171, 0.0000165364, 0.0000548225, 0.000127894, 0.000246368, 0.000420693, 0.00066123, 0.000978304, 0.00138223, 0.00188336, 0.00629048, 0.0145327, 0.028277, 0.0482765, 0.0761478, 0.112039, 0.157039, 0.210438, 0.272478, 0.341721, 0.417651, 0.498575, 0.583593, 0.671215, 0.760487, 0.850257, 0.86815, 0.886042, 0.903796, 0.92155, 0.938972, 0.956394, 0.972594, 0.988794, 0.99973, 0.353963, 0.32283, 0.291698, 0.260565, 0.229432, 0.198299, 0.167167, 0.0835833, 0., 0.};
  double NormOnMaxDPDsDxETL500keVEe20GeV[nX]={0.00000135255, 0.0000107297, 0.0000357707, 0.0000837971, 0.000161959, 0.000277327, 0.000436945, 0.000647871, 0.000917204, 0.0012521, 0.00422103, 0.00984178, 0.0193756, 0.0335311, 0.0538111, 0.0807558, 0.115909, 0.159394, 0.212449, 0.274542, 0.34627, 0.42641, 0.5148, 0.609764, 0.710518, 0.815236, 0.836579, 0.857922, 0.879353, 0.900783, 0.922087, 0.943391, 0.963656, 0.98392, 0.999035, 0.35518, 0.323942, 0.292703, 0.261465, 0.230226, 0.198988, 0.167749, 0.0838746, 0., 0.};
  double NormOnMaxDPDsDxETL600keVEe20GeV[nX]={0.00000094223, 0.00000752407, 0.0000251963, 0.0000592257, 0.000114779, 0.000196982, 0.00031096, 0.00046186, 0.00065488, 0.000895279, 0.0030381, 0.00712606, 0.0141301, 0.0246513, 0.0399686, 0.0606994, 0.0884211, 0.123657, 0.168145, 0.222104, 0.287132, 0.36288, 0.450424, 0.548669, 0.657855, 0.776108, 0.800934, 0.82576, 0.851098, 0.876437, 0.902062, 0.927686, 0.952672, 0.977658, 0.997765, 0.356517, 0.325163, 0.293809, 0.262454, 0.2311, 0.199745, 0.168391, 0.0841954, 0., 0.};
  double NormOnMaxDPDsDxETL700keVEe20GeV[nX]={0.000000693407, 0.0000055683, 0.0000187167, 0.0000441207, 0.000085702, 0.000147362, 0.000233008, 0.000346579, 0.000492056, 0.000673476, 0.00229724, 0.00541177, 0.0107838, 0.0189138, 0.0308712, 0.0472445, 0.0694931, 0.0982877, 0.135518, 0.181865, 0.23958, 0.309155, 0.392949, 0.490938, 0.605104, 0.734462, 0.762562, 0.790662, 0.819909, 0.849156, 0.87935, 0.909545, 0.939775, 0.970005, 0.995857, 0.357945, 0.326467, 0.294989, 0.263511, 0.232033, 0.200555, 0.169077, 0.0845384, 0., 0.};
  double NormOnMaxDPDsDxETL800keVEe20GeV[nX]={0.000000531212, 0.00000428729, 0.0000144574, 0.0000341644, 0.0000664944, 0.000114525, 0.000181345, 0.000270072, 0.000383862, 0.000525922, 0.00180163, 0.00425872, 0.00851723, 0.0149957, 0.0245903, 0.0378328, 0.0560222, 0.0798595, 0.111201, 0.150965, 0.20173, 0.264624, 0.343047, 0.43819, 0.55414, 0.691696, 0.722682, 0.753668, 0.786629, 0.819589, 0.854414, 0.889239, 0.925101, 0.960964, 0.993238, 0.35943, 0.327824, 0.296218, 0.264611, 0.233005, 0.201398, 0.169792, 0.0848961, 0., 0.};
  double NormOnMaxDPDsDxETL900keVEe20GeV[nX]={0.000000419646, 0.00000340266, 0.0000115072, 0.0000272518, 0.000053134, 0.000091649, 0.000145306, 0.000216639, 0.000308219, 0.000422661, 0.00145327, 0.00344494, 0.00690964, 0.0122008, 0.0200763, 0.0310077, 0.0461385, 0.066144, 0.092769, 0.127024, 0.171593, 0.228004, 0.300401, 0.391063, 0.506192, 0.649009, 0.682385, 0.715762, 0.752092, 0.788423, 0.827776, 0.867128, 0.908874, 0.95062, 0.989913, 0.36097, 0.32923, 0.297491, 0.265752, 0.234013, 0.202274, 0.170535, 0.0852675, 0., 0.};
  // initialize DsDx matrix
  for (int j = 0; j < nX; j++) {
    NormDsDx[0][j] = NormOnMaxDPDsDxETL1keVEe20GeV[j];
    NormDsDx[1][j] = NormOnMaxDPDsDxETL10keVEe20GeV[j];
    NormDsDx[2][j] = NormOnMaxDPDsDxETL20keVEe20GeV[j];
    NormDsDx[3][j] = NormOnMaxDPDsDxETL30keVEe20GeV[j];
    NormDsDx[4][j] = NormOnMaxDPDsDxETL40keVEe20GeV[j];
    NormDsDx[5][j] = NormOnMaxDPDsDxETL50keVEe20GeV[j];
    NormDsDx[6][j] = NormOnMaxDPDsDxETL60keVEe20GeV[j];
    NormDsDx[7][j] = NormOnMaxDPDsDxETL70keVEe20GeV[j];
    NormDsDx[8][j] = NormOnMaxDPDsDxETL100keVEe20GeV[j];
    NormDsDx[9][j] = NormOnMaxDPDsDxETL150keVEe20GeV[j];
    NormDsDx[10][j] = NormOnMaxDPDsDxETL200keVEe20GeV[j];
    NormDsDx[11][j] = NormOnMaxDPDsDxETL300keVEe20GeV[j];
    NormDsDx[12][j] = NormOnMaxDPDsDxETL400keVEe20GeV[j];
    NormDsDx[13][j] = NormOnMaxDPDsDxETL500keVEe20GeV[j];
    NormDsDx[14][j] = NormOnMaxDPDsDxETL600keVEe20GeV[j];
    NormDsDx[15][j] = NormOnMaxDPDsDxETL700keVEe20GeV[j];
    NormDsDx[16][j] = NormOnMaxDPDsDxETL800keVEe20GeV[j];
    NormDsDx[17][j] = NormOnMaxDPDsDxETL900keVEe20GeV[j];
  }

  // bounds for X

  if (Xtest < XX00[0]) return 0.; // Because the total cross section is obtained from the integration above this

  if (Xtest == XX00[0])
    Xtest = 1.00005 * XX00[0]; //  Lower limit for X

  if (Xtest >= XX00[nX-1] )
    Xtest  = 0.99995 * XX00[nX-1]; // Upper limit for X

  // bounds for mass of Dark state MA
  if (MAtest <= MMAA[0])
    MAtest = 1.00005 * MMAA[0]; //  Lower limit for mass

  if (MAtest >= MMAA[nMADS-1] )
    MAtest  = 0.99995 * MMAA[nMADS-1]; // Upper limit for mass

  return BilinearInterpolation<nX> (MAtest, Xtest, MMAA, XX00, NormDsDx, nMADS, 0);
}
